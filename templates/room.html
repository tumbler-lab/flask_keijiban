{% extends "base.html" %}
{% block body %}
<header id="header">
	
	<form action = "/{{username}}/user_page/" method = "GET">
		<input type="hidden" name="room_id", value={{room_id}} size="0">
		<h1>
			ãƒ«ãƒ¼ãƒ {{room_name}}
			<input class="button" type="submit" value="é€€å‡º">
		</h1>
	</form>
</header>
<div id="main">
	<p></p>
	<form action = "/{{username}}/room/{{room_name}}/" method = "POST">
		<p>
			<input id="messagebox" type="text" name="message" size="50" minlength="3" maxlength="1000"ã€€required  placeholder="{{room_name}}ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
			<input type="hidden" name="room_id", value={{room_id}} size="0">
			<input class="button" style="text-align: left" type="submit" value="ğŸ“©">
		</p>
	</form>
	<table>
		
		<tr>
			<th>ãƒ¦ãƒ¼ã‚¶å</th>
			<th>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</th>
			<th style="text-align: right" width="50%">æ™‚é–“</th>
		</tr>
		{% for message in messages %}
		<tr>
			<td>{{message[0]}}</td>
			<td>{{message[1]}}</td>
			<td style="text-align: right" width="50%">{{message[2]}}</td>
		</tr>
		{% endfor %}
	</table>
</div>
<aside id="sub" type="hidden">
	<form action = "/{{username}}/room/{{room_name}}/" method = "GET">
		<input type="hidden" name="room_id", value={{room_id}} size="0">
		<h1>
			<input class="button" type="submit" value="ãƒªãƒ­ãƒ¼ãƒ‰">
		</h1>
	</form>
</aside>
<!-- <aside id="sub" type="hidden">
	<h2>ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶</h2>
	<ul>
		{% for room_member in room_members %}
		<li>{{room_member[0]}}</li>
		{% endfor %}
	</ul>
</aside> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
	// let request = new XMLHttpRequest();
	// var timer1 = setTimeout(function(){
	// 	//location.reload(true)
	// 	// $.get(
	// 	// 		"{{url_for('load_chat', username=username, room_name=room_name)}}",
	// 	// 		{room_id : "{{room_id}}"}
	// 	// 	);
	// 	request.open('GET', "{{url_for('load_chat', username=username, room_name=room_name)}}?room_id={{room_id}}");
	// 	request.send();
	// 	}, 5000);
		// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¾—ãŸå ´åˆ
	function gotfocus() {
		//clearTimeout(timer1)
		this.style.height = "5em";             // é«˜ã•ã‚’5æ–‡å­—åˆ†ã«ã™ã‚‹
		this.style.backgroundColor = "#ffe";    // èƒŒæ™¯è‰²ã‚’è–„ã„é»„è‰²ã«ã™ã‚‹
		
	}
	// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¤±ã£ãŸå ´åˆ
	function lostfocus() {
		if( this.value.length == 0 ) {
			// æ–‡å­—æ•°ãŒã‚¼ãƒ­ãªã‚‰
			this.style.height = "3em";          // é«˜ã•ã‚’3æ–‡å­—åˆ†ã«ã™ã‚‹
		}
		this.style.backgroundColor = "#fff";    // èƒŒæ™¯è‰²ã‚’ç™½è‰²ã«ã™ã‚‹
		// timer1 = setTimeout(function(){
		// 	// $.get(
		// 	// 	"{{url_for('load_chat', username=username, room_name=room_name)}}",
		// 	// 	{room_id : "{{room_id}}"}
		// 	// );
		// 	request.open('GET', "{{url_for('load_chat', username=username, room_name=room_name)}}?room_id={{room_id}}");
		// 	request.send();
		// }, 5000);
	}
	// ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ã€ä¸Šè¨˜é–¢æ•°ã‚’å‰²ã‚Šå½“ã¦ã‚‹
	document.getElementById("messagebox").onfocus = gotfocus;    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¾—ãŸå ´åˆ
	document.getElementById("messagebox").onblur = lostfocus;    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¤±ã£ãŸå ´åˆ
	// $('#messagebox').onfocus = gotfocus;
	// $('#messagebox').onblur = lostfocus;
</script>
{% endblock %}

